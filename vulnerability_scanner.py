
#!/usr/bin/env python3
"""
ETHICAL VULNERABILITY SCANNER - FOR EDUCATIONAL PURPOSES
Author: [Your Name]
License: MIT
"""

import sys
import json
from datetime import datetime
from typing import List, Dict, Optional
import ipaddress

class EthicalScanner:
    """Class untuk scanning vulnerabilities secara etis"""
    
    def __init__(self, target: str, authorized: bool = False):
        self.target = target
        self.authorized = authorized
        self.results = []
        
        # Validasi target
        self._validate_target()
    
    def _validate_target(self):
        """Validasi target hanya untuk localhost atau izin khusus"""
        allowed_targets = [
            "localhost",
            "127.0.0.1",
            "192.168.1.1",
            "testphp.vulnweb.com",  # Website testing legal
            "demo.testfire.net"     # Website testing legal
        ]
        
        # Cek jika target mengandung localhost
        if any(allowed in self.target for allowed in allowed_targets):
            print(f"[INFO] Target {self.target} diizinkan untuk testing")
        elif not self.authorized:
            print("[ERROR] Target tidak diizinkan tanpa otorisasi!")
            print("[INFO] Gunakan hanya pada:")
            print("       - localhost/127.0.0.1")
            print("       - Website testing legal")
            print("       - Sistem dengan izin tertulis")
            sys.exit(1)
    
    def simulate_scan(self) -> 'EthicalScanner':
        """Simulasi scanning tanpa exploitasi nyata"""
        
        print(f"[+] Memulai ethical scan pada: {self.target}")
        print("[+] Mode: SIMULASI (educational purposes)\n")
        
        # Simulasi checks
        checks = [
            self._check_http_headers,
            self._check_common_paths,
            self._check_ssl_tls,
            self._check_server_info,
            self._check_cors_policy
        ]
        
        for check in checks:
            try:
                result = check()
                self.results.append(result)
            except Exception as e:
                print(f"[!] Error dalam check: {e}")
        
        return self
    
    def _check_http_headers(self) -> Dict:
        """Check HTTP headers security"""
        print("[*] Checking HTTP Security Headers...")
        
        # Simulasi headers yang seharusnya ada
        security_headers = {
            "X-Frame-Options": "SAMEORIGIN",
            "X-Content-Type-Options": "nosniff",
            "Strict-Transport-Security": "max-age=31536000",
            "Content-Security-Policy": "default-src 'self'",
            "X-XSS-Protection": "1; mode=block"
        }
        
        return {
            "check": "HTTP Security Headers",
            "status": "info",
            "message": "Security headers membantu mencegah berbagai serangan",
            "recommendation": "Implementasikan security headers yang sesuai",
            "severity": "medium"
        }
    
    def _check_common_paths(self) -> Dict:
        """Check common exposed paths"""
        print("[*] Checking Common Exposed Paths...")
        
        common_paths = [
            "/admin", "/wp-admin", "/phpmyadmin",
            "/config", "/backup", "/logs",
            "/.git", "/.env", "/robots.txt"
        ]
        
        return {
            "check": "Common Exposed Paths",
            "status": "warning",
            "message": "Beberapa path umum dapat diekspos",
            "recommendation": "Restrict access to sensitive directories",
            "severity": "low"
        }
    
    def _check_ssl_tls(self) -> Dict:
        """Check SSL/TLS configuration"""
        print("[*] Checking SSL/TLS Configuration...")
        
        return {
            "check": "SSL/TLS Configuration",
            "status": "info",
            "message": "Gunakan TLS 1.2 atau lebih tinggi",
            "recommendation": "Update SSL/TLS configuration regularly",
            "severity": "high"
        }
    
    def _check_server_info(self) -> Dict:
        """Check server information exposure"""
        print("[*] Checking Server Information...")
        
        return {
            "check": "Server Information Exposure",
            "status": "warning",
            "message": "Server info dapat membantu attacker",
            "recommendation": "Minimalkan informasi server yang diekspos",
            "severity": "medium"
        }
    
    def _check_cors_policy(self) -> Dict:
        """Check CORS policy"""
        print("[*] Checking CORS Policy...")
        
        return {
            "check": "CORS Policy",
            "status": "info",
            "message": "CORS misconfiguration dapat menyebabkan security issues",
            "recommendation": "Implementasikan CORS policy yang ketat",
            "severity": "medium"
        }
    
    def generate_report(self) -> str:
        """Generate laporan hasil scanning"""
        report = {
            "target": self.target,
            "scan_date": datetime.now().isoformat(),
            "scanner": "Ethical Vulnerability Scanner v1.0",
            "purpose": "Educational Security Assessment",
            "results": self.results,
            "summary": {
                "total_checks": len(self.results),
                "high_severity": len([r for r in self.results if r["severity"] == "high"]),
                "medium_severity": len([r for r in self.results if r["severity"] == "medium"]),
                "low_severity": len([r for r in self.results if r["severity"] == "low"])
            },
            "disclaimer": "Laporan ini hanya untuk tujuan edukasi. Selalu dapatkan izin sebelum testing."
        }
        
        return json.dumps(report, indent=2)

def main():
    """Main function untuk demo"""
    
    print("="*60)
    print("ETHICAL VULNERABILITY SCANNER - DEMO")
    print("="*60)
    print("\n⚠️  HANYA UNTUK EDUKASI DAN TESTING LEGAL ⚠️\n")
    
    # Hanya izinkan target tertentu
    target = input("Masukkan target (localhost/127.0.0.1): ").strip()
    
    if not target:
        target = "http://localhost"
    
    # Buat scanner instance
    scanner = EthicalScanner(target=target)
    
    # Jalankan scan
    scanner.simulate_scan()
    
    # Generate report
    report = scanner.generate_report()
    
    print("\n" + "="*60)
    print("SCAN REPORT")
    print("="*60)
    print(report)
    
    # Save to file
    with open("scan_report.json", "w") as f:
        f.write(report)
    
    print("\n[✓] Report disimpan sebagai scan_report.json")
    print("[✓] Scan selesai secara etis!")

if __name__ == "__main__":
    main()
